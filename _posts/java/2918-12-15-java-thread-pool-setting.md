---
layout: post
title: JAVA线程池设定
category: JAVA
keywords: 
---

## 正文
《Java并发编程实战》一书中，Brian Goetz和合著者们为线程池大小 的优化提供了不少中肯的建议。这非常重要，如果线程池中线程的数量过多，最终它们会竞争 稀缺的处理器和内存资源，浪费大量的时间在上下文切换上。反之，如果线程的数目过少，正 如你的应用所面临的情况，处理器的一些核可能就无法充分利用。Brian Goetz建议，线程池大 小与处理器的利用率之比可以使用下面的公式进行估算:

```
Nthreads = NCPU * UCPU * (1 + W/C)
```

其中: 

* NCPU是处理器的核的数目，可以通过Runtime.getRuntime().availableProce-ssors()得到 
* UCPU是期望的CPU利用率(该值应该介于0和1之间) 
* W/C是等待时间与计算时间的比率


你的应用99%的时间都在等待商店的响应，所以估算出的W/C比率为100。这意味着如果你 期望的CPU利用率是100%，你需要创建一个拥有400个线程的线程池。实际操作中，如果你创建 的线程数比商店的数目更多，反而是一种浪费，因为这样做之后，你线程池中的有些线程根本没 有机会被使用。出于这种考虑，我们建议你将执行器使用的线程数，与你需要查询的商店数目设 定为同一个值，这样每个商店都应该对应一个服务线程。不过，为了避免发生由于商店的数目过 多导致服务器超负荷而崩溃，你还是需要设置一个上限，比如100个线程。代码清单如下所示。